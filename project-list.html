<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name='viewport' content='width=device-width,minimum-scale=1.0 maximum-scale=1.0 user-scalable=no'>
    <meta name="format-detection" content="telephone=no" />
    <title>我的账户</title>
    <link rel="stylesheet" href="./src/iconfont/iconfont.css" />
    <link rel="stylesheet" href="./src/stylesheets/base.css" />
    <link rel="stylesheet" href="./src/stylesheets/common.css" />
    <script src="./src/js/common/compatible.js"></script>
</head>
<body>
    <div class="wx-scroll-wrap">

        <div class="wx-nav nav-button nav-history-back">
            <div data-js="back" class="wx-nav-back">
                <i class="iconfont"></i>
            </div>
            <div class="wx-nav-box">更多项目</div>
        </div>


    

<script type="text/javascript">
    var Config = {
        url: '/Project/GetProjectList',
        activityStartTime: '2016/5/1',
        activityEndTime: '2016/6/31'
    }
</script>

<div class="iscroll-bd" id="iscroll-bd">
    <div style="transition-timing-function: cubic-bezier(0.1, 0.57, 0.1, 1); transition-duration: 0ms; transform: translate(0px, -668px) translateZ(0px);">
        <div class="wx-banner" id="wx-banner">
            <div id="iSlider-wrapper"><ul class="islider-outer"><li class=" islider-prev" style="transform: translateZ(0px) translateX(-414px);"></li><li class="islider-html islider-active" style="transform: translateZ(0px) translateX(0px);"><a href="http://www.ppmoney.com"><img src="https://m-static.ppmoney.com/PublicTest/Img/1db1dc2a-06ac-4074-a1ec-add3b442e91b.jpg"></a></li><li class=" islider-next" style="transform: translateZ(0px) translateX(414px);"></li></ul></div>
        <ul class="islider-dot-wrap"><li class="islider-dot active" index="0"></li></ul></div>
        <div class="wx-home" id="wx-home"><section class="prj-panel prj-d-panel">                            <div class="prj-tag">优选</div>                            <h2 class="prj-tl">【加多保】</h2>                            <p class="prj-rate">15<i class="small-rate">%</i></p>                            <div class="prj-cont prj-item">                                <div class="prj-time">                                    <p><i class="fs32">90</i>天</p>                                    <p class="cl-grey">投资期限</p>                                </div>                                <div class="prj-time">                                    <p><i class="fs32">100</i>元</p>                                    <p class="cl-grey">起投金额</p>                                </div>                                <div class="prj-time">                                    <p><i class="fs32">0</i>人</p>                                    <p class="cl-grey">已购人数</p>                                </div>                            </div>                            <a class="btn btn-org prj-btn" href="/Project/ProjectDetail?ProjectId=7494">立即抢购</a>                        </section><section class="prj-panel">                                            <div class="prj-tag">活动</div>                                            <a href="/Project/ProjectDetail?ProjectId=7431" class="prj-href">                                                <h3 class="prj-tl">安稳盈</h3>                                                <div class="prj-cont">                                                    <div class="prj-rate">10<i class="small-rate">%</i>+0.5<i class="small-rate">%</i></div>                                                    <div class="prj-time">                                                        <p><i class="fs32">90</i>天</p>                                                        <p class="cl-grey">投资期限</p>                                                    </div>                                                    <div class="prj-status"><div class="prj-ongoing">                    <div class="progress"><div class="progress-bar" aria-valuenow="33" aria-valuemin="0" aria-valuemax="100" style="width: 33%"></div></div>                    <p class="progress-rate">33%</p></div></div>                                                </div>                                            </a>                                        </section><section class="prj-panel">                                            <div class="prj-tag">活动</div>                                            <a href="/Project/ProjectDetail?ProjectId=7492" class="prj-href">                                                <h3 class="prj-tl">加多保</h3>                                                <div class="prj-cont">                                                    <div class="prj-rate"><div class="profit-ttyb">7<i class="small-rate">%</i>~14<i class="small-rate">%</i></div></div>                                                    <div class="prj-time">                                                        <p><i class="fs32">90</i>天</p>                                                        <p class="cl-grey">投资期限</p>                                                    </div>                                                    <div class="prj-status"><div data-start="7492" class="prj-start">23:35:58后开抢</div></div>                                                </div>                                            </a>                                        </section><section class="prj-panel">                                            <div class="prj-tag">活动</div>                                            <a href="/Project/ProjectDetail?ProjectId=7495" class="prj-href">                                                <h3 class="prj-tl">加多保</h3>                                                <div class="prj-cont">                                                    <div class="prj-rate">9<i class="small-rate">%</i></div>                                                    <div class="prj-time">                                                        <p><i class="fs32">90</i>天</p>                                                        <p class="cl-grey">投资期限</p>                                                    </div>                                                    <div class="prj-status"><div data-start="7495" class="prj-start">23:45:09后开抢</div></div>                                                </div>                                            </a>                                        </section><section class="prj-panel">                                <a href="/DailyBao/Index" class="prj-href">                                    <h3 class="prj-tl">灵活宝<i class="version">2.0</i><span class="tl-exp">100元起存，灵活理财</span></h3>                                    <div class="prj-cont prj-lhb">                                        <div class="prj-rate">5<i class="small-rate">%</i></div>                                        <div class="prj-time">                                            <p><i class="fs32">0</i></p>                                            <p class="cl-grey">融资余额（元）</p>                                        </div>                                        <div class="prj-status"></div>                                    </div>                                </a>                            </section><div class="home-tip">市场有风险 投资需谨慎</div></div>
    </div>
</div>


<footer class="wx-footer">
    <div class="main-menu">
        <div class="menu-item">
            <a href="/Project/ProjectList">
                <i class="icon iconfont"></i>
                <p>理财</p>
            </a>
        </div>
        <div class="menu-item">
            <a href="/PPPartner">
                <i class="icon iconfont"></i>
                <p>佣金</p>
            </a>
        </div>
        <div class="menu-item">
            <a href="/UserCenter">
                <i class="icon iconfont"></i>
                <p>我</p>
            </a>
        </div>
    </div>
</footer>

<script src="./src/js/common/compatible.js?v=20150710"></script>
<script src="./src/js/zepto.min.js?v=20150710"></script>
<script src="./src/js/common/common.js?v=20150710"></script>
<script src="./ppmobile/assets/pp-mobile.js?v=20150710"></script>
<script src="./src/js/iscroll-probe.js?v=20150710"></script>
<script>
    var bannerjson = [{"content":"https://m-static.ppmoney.com/PublicTest/Img/1db1dc2a-06ac-4074-a1ec-add3b442e91b.jpg","link":"http://www.ppmoney.com","paramsInt":0,"IsCloudStorage":false}];
    var myScroll = new IScroll('#iscroll-bd', {
        mouseWheel: false,
        preventDefault: false
    });
    document.addEventListener('touchmove', function (e) { e.preventDefault(); }, false);

    var bannerList=[];
    if(bannerjson && bannerjson.length>0)
    {
        $.each(bannerjson,function(i,obj){
            var content =  {
                content: '<a href="'+(obj.link==null&&obj.link==""?'javascript:;':obj.link)+'"><img src="'+obj.content+'" /></a>'
            }
            bannerList.push(content);
        });
    }

    if (bannerList && bannerList.length>0) {
        var islider = new iSlider({
            dom: document.getElementById('iSlider-wrapper'),
            data: bannerList,
            isLooping: true,
            isAutoplay: true,
            isOverspread: true,
            animateTime: 800, // ms
            plugins: ['dot']
        });
    } else {
        $("#wx-banner").addClass("hide");
    }

    //活动开始时间/结束时间/当前时间
    var actStartTime = new Date(Config.activityStartTime).getTime();
    var actEndTime = new Date(Config.activityEndTime).getTime();
    var curTime = new Date().getTime();

    //$(function () {

        var tokenFeild = $("input[name='__RequestVerificationToken']");
        $.ajax({
            url: Config.url,
            type: "POST",
            data: { '__RequestVerificationToken': tokenFeild.val() },
            dataType: 'json',
            success: function (data) {
                console.log(data);
                curTime = data.dateTime;
                var _firHtml = "", endHtml = "", surplusHtml = "";
                var prjModelType = data.list[0].PrjModelType;
                var connerTxt = "优选";
                if(prjModelType == 103007){
                    connerTxt = "特权";
                }
                
                //第一个活动角标
                if (!((data.list[0].PrjModelType == 103004) || (data.list[0].PrjType == 104025) || (actStartTime > new Date(curTime)) || (actEndTime <= new Date(curTime)))) {
                    connerTxt = "活动";
                }

                _firHtml = '<section class="prj-panel prj-d-panel">\
                            <div class="prj-tag">' + connerTxt + '</div>\
                            <h2 class="prj-tl">【' + selectProjectName(data.list[0].PrjType, data.list[0].CouponTypes, data.list[0].PrjModelType).prjName + '】</h2>\
                            <p class="prj-rate">' + getRate(data.list[0].Rate,data.list[0].MinRate, data.list[0].MaxRate, data.list[0].PrjModelType, data.list[0].DisplayRewardRate) + '</p>\
                            <div class="prj-cont prj-item">\
                                <div class="prj-time">\
                                    <p><i class="fs32">' + data.list[0].Deadline + '</i>' + (data.list[0].IsDayPrj ? "天" : "个月") + '</p>\
                                    <p class="cl-grey">投资期限</p>\
                                </div>\
                                <div class="prj-time">\
                                    <p><i class="fs32">' + data.list[0].MinAmount + '</i>元</p>\
                                    <p class="cl-grey">起投金额</p>\
                                </div>\
                                <div class="prj-time">\
                                    <p><i class="fs32">' + data.list[0].InvestRecordTotalCount + '</i>人</p>\
                                    <p class="cl-grey">已购人数</p>\
                                </div>\
                            </div>\
                            <a class="btn btn-org prj-btn" href="/Project/ProjectDetail?ProjectId=' + data.list[0].PrjId + '">立即抢购</a>\
                        </section>';
                _endHtml = '<section class="prj-panel">\
                                <a href="/DailyBao/Index" class="prj-href">\
                                    <h3 class="prj-tl">灵活宝<i class="version">2.0</i><span class="tl-exp">100元起存，灵活理财</span></h3>\
                                    <div class="prj-cont prj-lhb">\
                                        <div class="prj-rate">' + data.millionProfit + '<i class="small-rate">%</i></div>\
                                        <div class="prj-time">\
                                            <p><i class="fs32">' + millionExactly(data.investableAmount) + '</i></p>\
                                            <p class="cl-grey">融资余额（元）</p>\
                                        </div>\
                                        <div class="prj-status"></div>\
                                    </div>\
                                </a>\
                            </section>';
                if (data.list.length > 1) {
                    for (var i = 1; i < data.list.length; i++) {
                        //角标判断
                        var corner = selectProjectName(data.list[i].PrjType, data.list[i].CouponTypes, data.list[i].PrjModelType).prjStatus ? '<div class="prj-tag">' + selectProjectName(data.list[i].PrjType, data.list[i].CouponTypes, data.list[i].PrjModelType).stateName + '</div>' : "";
                        surplusHtml += '<section class="prj-panel">\
                                            ' + corner + '\
                                            <a href="/Project/ProjectDetail?ProjectId=' + data.list[i].PrjId + '" class="prj-href">\
                                                <h3 class="prj-tl">' + data.list[i].PrjTypeName + '</h3>\
                                                <div class="prj-cont">\
                                                    <div class="prj-rate">' + getRate(data.list[i].Rate, data.list[i].MinRate, data.list[i].MaxRate, data.list[i].PrjModelType, data.list[i].DisplayRewardRate) + '</div>\
                                                    <div class="prj-time">\
                                                        <p><i class="fs32">' + data.list[i].Deadline + '</i>' + (data.list[i].IsDayPrj ? "天" : "个月") + '</p>\
                                                        <p class="cl-grey">投资期限</p>\
                                                    </div>\
                                                    <div class="prj-status">' + getFinancesStatus(data.list[i].PrjId, data.list[i].AmountBalance, data.list[i].AmountTotal, data.list[i].ApplyBeginTime, data.dateTime) + '</div>\
                                                </div>\
                                            </a>\
                                        </section>';
                    }
                }

                $("#wx-home").html("").append(_firHtml).append(surplusHtml).append(_endHtml).append('<div class="home-tip">市场有风险 投资需谨慎</div>');
                myScroll.refresh();
            },
            error: function () {
                console.log(Config.url)
            }
        });
    //});

    //通过标的类型获得标的名称
    var selectProjectName = function(proType, couponTypes, proModelType) {
        var prjObj = {
            prjName: "",
            prjStatus: false,
            stateName: ""
        };
        switch (proType) {
            case 104003://惠商贷
                prjObj.prjName = "惠商贷";
                break;
            case 104004://流转贷
                prjObj.prjName = "流转贷";
                break;
            case 104006://活动标
                prjObj.prjName = "活动标";
                break;
            case 104017://小贷宝
                prjObj.prjName = "小贷宝";
                break;
            case 104018://小贷宝2号
                prjObj.prjName = "小贷宝2号";
                break;
            case 104019://典当宝
                prjObj.prjName = "典当宝";
                break;
            case 104027://车押贷
                prjObj.prjName = "车押贷";
                break;
            case 104028://惠民贷
                prjObj.prjName = "机构保";
                break;
            case 104021://配资
                prjObj.prjName = "配资宝";
                break;
            case 104026://赎楼贷
                prjObj.prjName = "赎楼宝";
                break;
            case 104014://理财产品
                prjObj.prjName = "理财产品";
                break;
            case 104015://安稳盈
                prjObj.prjName = "安稳盈";
                break;
            case 104029://信托宝
                prjObj.prjName = "信托宝";
                break;
            case 104020://加多保
                prjObj.prjName = "加多保";
                break;
            case 104023:
                prjObj.prjName = "懒人宝";
                break;
            case 104025:
                prjObj.prjName = "体验标";
                break;
            case 103004:
                prjObj.prjStatus = true;
                prjObj.prjName = "新人惠";
                prjObj.stateName = "新人惠";
                break;
            case 103006:
                prjObj.prjStatus = true;
                prjObj.prjName = "天天押宝";
                prjObj.stateName = "天天押宝";
                break;
            default:
                prjObj.prjName = "安稳盈";
                break;
        }
        
        if (!((proModelType == 103004) || (proType == 104025) || (actStartTime > new Date(curTime)) || (actEndTime <= new Date(curTime)))) {
            prjObj.prjStatus = true;
            prjObj.stateName = "活动";
            return prjObj;
        }else{

            if (couponTypes.length > 0) {
                for (var i = 0; i < couponTypes.length; i++) {
                    if (couponTypes[i] == 14) {
                        prjObj.prjStatus = true;
                        prjObj.prjName = "续投标";
                        prjObj.stateName = "续投标";
                        return prjObj;
                    }
                }
            }
            return prjObj;
        }
    }
    //获取标的利率
    var getRate = function (rate, minRate, maxRate, prjType, displayRewardRate) {
        var _rateHtml = "";
        if (prjType == 103006) {
            _rateHtml = '<div class="profit-ttyb">' + minRate + '<i class="small-rate">%</i>~' + maxRate + '<i class="small-rate">%</i></div>';
        } else if (displayRewardRate > 0) {
            _rateHtml = (rate - displayRewardRate) + '<i class="small-rate">%</i>+' + displayRewardRate + '<i class="small-rate">%</i>';
        } else {
            _rateHtml = rate + '<i class="small-rate">%</i>';
        }
        return _rateHtml;
    }
    //判断融资状态
    var getFinancesStatus = function (prjId,balance,total,beginTime,nowTime) {
        var status = -1, btnText = '', _html = "",_startHtml = "";
        if (balance <= 0) {
            status = 2;
            btnText = "已融满";
        }
        else if (new Date(beginTime).getTime() > new Date(nowTime).getTime()) {
            status = 1;
            btnText = "未开始";
            new PPCountDown({
                from: new Date(nowTime).getTime(),
                to: new Date(beginTime).getTime(),
                refresh: function (elem, time) {
                    $('[data-start="' + prjId + '"]').html(time + '后开抢').addClass("prj-start");
                },
                callback: function () {
                    var progress = parseInt((total - balance) / total * 100);
                    var _investHtml = '<div class="prj-ongoing">\
                                        <div class="progress">\<div class="progress-bar" aria-valuenow="' + progress + '" aria-valuemin="0" aria-valuemax="100" style="width: ' + progress + '%"></div></div>\
                                        <p class="progress-rate">' + progress + '%</p></div>';
                    $('[data-start="' + prjId + '"]').html(_investHtml).removeClass("prj-start").addClass("prj-end prj-in");
                }
            }).start();
        }
        else {
            status = 0;
            btnText = "立即投资";
        }
        switch (status) {
            case 0://立即投资
                var progress = parseInt((total - balance) / total * 100);
                _html = '<div class="prj-ongoing">\
                    <div class="progress">\<div class="progress-bar" aria-valuenow="' + progress + '" aria-valuemin="0" aria-valuemax="100" style="width: ' + progress + '%"></div></div>\
                    <p class="progress-rate">' + progress + '%</p></div>';
                break;
            case 1://未开始
                _html = '<div data-start="' + prjId + '"></div>';
                break;
            case 2://已融满
                _html = '<div class="prj-end">已融满</div>';
                break;
        }

        return _html;
    }
    //数值以万为分界点显示
    var millionExactly = function (value) {
        var _val = parseInt(value),result = "";
        if (_val / 10000 > 1) {
            result = numFormat(_val / 10000,2) + "万";
        } else {
            result = _val;
        }
        return result;
    }
</script>


    
    </div>
    <script>
        bindNavButton();
    </script>

</body>
</body>
</html>